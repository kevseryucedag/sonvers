<!-- =============================
     SLIDER YÖNETİMİ — SKATEX ADMIN
============================== -->

<div>
    <h2 class="dash-title">Slider Yönetimi</h2>
    <p class="dash-subtitle">Anasayfadaki otomatik değişen slider görsellerini buradan kontrol edebilirsin.</p>

    <!-- SLIDER EKLEME FORMU -->
    <div class="pixel-box" style="padding:20px; margin-bottom:25px;">
        <h3 style="font-family:'Press Start 2P'; color:#00ff99;">Yeni Slider Ekle</h3>

        <form id="slider-add-form" class="admin-form">

            <label>Başlık</label>
            <input type="text" id="s-title" required>

            <label>Açıklama</label>
            <input type="text" id="s-desc" required>

            <label>Görsel</label>
            <input type="file" id="s-image" accept="image/*">

            <button type="submit">Slider Ekle</button>
        </form>
    </div>

    <!-- SLIDER TABLOSU -->
    <div class="pixel-box" style="padding:20px;">
        <h3 style="font-family:'Press Start 2P'; color:#00ff99;">Slider Listesi</h3>

        <table class="admin-table" id="slider-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Önizleme</th>
                    <th>Başlık</th>
                    <th>Açıklama</th>
                    <th>Sil</th>
                </tr>
            </thead>
            <tbody id="slider-table-body">
                <!-- JS ile doldurulacak -->
            </tbody>
        </table>
    </div>
</div>


<!-- ======================================
     SLIDER VIEW SCRIPTİ
======================================= -->

<script>
window.onViewLoaded = function(view) {
    if (view !== "slider") return;

    console.log("Slider View Yüklendi");

    /* ============================
       STORAGE SİSTEMİ
    ============================ */

    function loadSliders() {
        return JSON.parse(localStorage.getItem("admin_sliders") || "[]");
    }

    function saveSliders(list) {
        localStorage.setItem("admin_sliders", JSON.stringify(list));
    }

    // Örnek slider ekle
    function initSliders() {
        let list = loadSliders();
        if (list.length === 0) {
            list = [
                {
                    id: Date.now(),
                    title: "Yeni SkateX Sezonu Başladı!",
                    desc: "Mint yeşili retro temamız yayında.",
                    image: null
                }
            ];
            saveSliders(list);
        }
    }

    /* ============================
       TABLOYU ÇİZ
    ============================ */

    function renderSliders() {
        const list = loadSliders();
        const tbody = document.getElementById("slider-table-body");

        tbody.innerHTML = list.map(s => `
            <tr>
                <td>${s.id}</td>

                <td>
                    ${s.image 
                        ? `<img src="${s.image}" style="width:70px; height:70px; object-fit:cover; border-radius:6px;">`
                        : `<div style="color:#666;">(Yok)</div>`}
                </td>

                <td>${s.title}</td>
                <td>${s.desc}</td>

                <td>
                    <button class="admin-delete-slider" data-id="${s.id}">
                        Sil
                    </button>
                </td>
            </tr>
        `).join("");
    }

    /* ============================
       SLIDER EKLE
    ============================ */

    document.getElementById("slider-add-form").addEventListener("submit", async (e) => {
        e.preventDefault();

        const title = document.getElementById("s-title").value;
        const desc = document.getElementById("s-desc").value;

        const imgInput = document.getElementById("s-image");
        let imageData = null;

        // Görsel base64'e dönüştürülüyor (backend yok → localStorage için gerekli)
        if (imgInput.files.length > 0) {
            imageData = await fileToBase64(imgInput.files[0]);
        }

        const list = loadSliders();

        list.push({
            id: Date.now(),
            title,
            desc,
            image: imageData
        });

        saveSliders(list);
        renderSliders();
        alert("Slider başarıyla eklendi!");
        e.target.reset();
    });

    // Dosyayı base64 string'e çevir
    function fileToBase64(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.readAsDataURL(file);
        });
    }

    /* ============================
       SLIDER SİLME
    ============================ */

    document.addEventListener("click", (e) => {
        if (!e.target.classList.contains("admin-delete-slider")) return;

        const id = e.target.dataset.id;

        let list = loadSliders();
        list = list.filter(s => String(s.id) !== String(id));
        saveSliders(list);
        renderSliders();
    });

    /* ============================
       İLK ÇALIŞMA
    ============================ */

    initSliders();
    renderSliders();
};
</script>
